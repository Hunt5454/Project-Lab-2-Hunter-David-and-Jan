#include <inttypes.h>

#include "WiFiEsp.h"
#include "WiFiEspClient.h"
#include "WiFiEspServer.h"

#include <ArduinoJson.h>

const char* ssid     = "TTUSwarmField";
const char* password = NULL;

IPAddress server(172,16,0,1);

const char* data = "";   // String with json data
float temp = 0.0;

WiFiEspClient client;

unsigned long lastConnectionTime = 0;            // last time you connected to the server, in milliseconds
const unsigned long postingInterval = 10L * 1000L; // delay between updates, in milliseconds

void setup() {
  Serial.begin(9600);
  delay(10);

  // We start by connecting to a WiFi network

  Serial.println();
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(ssid);

  WiFi.begin(ssid, password);

  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());

  client.connect(server,8001);
  while(!client.connected()){
    delay(500);
    Serial.print(".");
    client.connect(server,8001);
  }
  Serial.println("Connected to Server");
   float LeftBound[];
 float RightBound[];
 float TopBound[];
 float BottomBound[];
 float goalLeft[];
 float goalRight[];
 float midpoint[];
 
}

void loop() {
  client.write("%GET{FieldData}%");
  while(client.available()){
   data += client.read();
  }
  parseJSON(data);
  CreateBound(Corners0_X,Corners0_Y,Corners1_X,Corners1_Y,Corners2_X,Corners2_Y,Corners3_X,Corners3_Y);
  }

void CreateMap(float c1x,float c1y,float c2x,float c2y,float c3x,float c3y,float c4x,float c4y){
 float LeftBound[]={c2x,c1x,c1y,c2y};
 float RightBound[4]={c3x,c4x,c3y,c4y};
 float TopBound[4]={c1x,c3x,c1y,c3y}
 float BottomBound[]={c2x.c4x,c4y,c2y};
 float goalLeft[]=c2x,c1x,(c1y+c2y)/4,3(c1y+c2y)/4 ;
 float goalRight[]=c3x,c4x,(c3y+c4y)/4,3(c3y+c4y)/4;
 float midpoint=(c2x+c1x+c0x+c4x)/4;
 
 

  
}


bool Teamside(float x,int team){
  if (
}
void parseJSON(const char* json)
{
  const size_t bufferSize = JSON_ARRAY_SIZE(4) + 11*JSON_OBJECT_SIZE(2) + 2*JSON_OBJECT_SIZE(3) + 8*JSON_OBJECT_SIZE(4) + 7*JSON_OBJECT_SIZE(6) + 1410;
DynamicJsonBuffer jsonBuffer(bufferSize);
  JsonObject& root = jsonBuffer.parseObject(json);


JsonObject& Ball = root["Ball"];

float Ball_Object_Center_X = Ball["Object Center"]["X"]; // 240.1168
float Ball_Object_Center_Y = Ball["Object Center"]["Y"]; // 149.2336


int Ball_Area = Ball["Area"]; // 137
float Ball_Orientation = Ball["Orientation"]; // 153.0431
int Ball_Aspect_Ratio = Ball["Aspect Ratio"]; // 1
int Ball_Nb_Holes = Ball["Nb Holes"]; // 1

JsonArray& Corners = root["Corners"];

float Corners0_X = Corners[0]["X"]; // 12.0495
float Corners0_Y = Corners[0]["Y"]; // 210.9505

float Corners1_X = Corners[1]["X"]; // 414.7983
float Corners1_Y = Corners[1]["Y"]; // 197.7204

float Corners2_X = Corners[2]["X"]; // 32.96965
float Corners2_Y = Corners[2]["Y"]; // 39.06929

float Corners3_X = Corners[3]["X"]; // 380.2392
float Corners3_Y = Corners[3]["Y"]; // 22.04729

JsonObject& Red_Team_Data = root["Red Team Data"];

JsonObject& Red_Team_Data_Circle = Red_Team_Data["Circle"];

float Red_Team_Data_Circle_Object_Center_X = Red_Team_Data_Circle["Object Center"]["X"]; // 137.058
float Red_Team_Data_Circle_Object_Center_Y = Red_Team_Data_Circle["Object Center"]["Y"]; // 103.4375



JsonObject& Red_Team_Data_Square = Red_Team_Data["Square"];

float Red_Team_Data_Square_Object_Center_X = Red_Team_Data_Square["Object Center"]["X"]; // 87.07018
float Red_Team_Data_Square_Object_Center_Y = Red_Team_Data_Square["Object Center"]["Y"]; // 91.53947



JsonObject& Red_Team_Data_Triangle = Red_Team_Data["Triangle"];

float Red_Team_Data_Triangle_Object_Center_X = Red_Team_Data_Triangle["Object Center"]["X"]; // 133.7784
float Red_Team_Data_Triangle_Object_Center_Y = Red_Team_Data_Triangle["Object Center"]["Y"]; // 58.8125


JsonObject& Blue_Team_Data = root["Blue Team Data"];

JsonObject& Blue_Team_Data_Circle = Blue_Team_Data["Circle"];

float Blue_Team_Data_Circle_Object_Center_X = Blue_Team_Data_Circle["Object Center"]["X"]; // 355.0485
float Blue_Team_Data_Circle_Object_Center_Y = Blue_Team_Data_Circle["Object Center"]["Y"]; // 119.489


JsonObject& Blue_Team_Data_Square = Blue_Team_Data["Square"];

float Blue_Team_Data_Square_Object_Center_X = Blue_Team_Data_Square["Object Center"]["X"]; // 291.5776
float Blue_Team_Data_Square_Object_Center_Y = Blue_Team_Data_Square["Object Center"]["Y"]; // 95.96983




JsonObject& Blue_Team_Data_Triangle = Blue_Team_Data["Triangle"];

float Blue_Team_Data_Triangle_Object_Center_X = Blue_Team_Data_Triangle["Object Center"]["X"]; // 291.5459
float Blue_Team_Data_Triangle_Object_Center_Y = Blue_Team_Data_Triangle["Object Center"]["Y"]; // 54.35204

}
